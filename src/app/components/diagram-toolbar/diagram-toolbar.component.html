<div class="toolbar" [class.collapsed]="isCollapsed" [style.width.px]="isCollapsed ? 50 : sidebarWidth">
  <div class="toolbar-header">
    <button (click)="toggleSidebar()" class="sidebar-toggle" [title]="isCollapsed ? 'Expand Sidebar' : 'Collapse Sidebar'">
      {{ isCollapsed ? 'â–¶' : 'â—€' }}
    </button>
  </div>

  <div class="toolbar-content" [class.collapsed]="isCollapsed">
    <div class="toolbar-section" *ngIf="!selectedNodeId && !selectedBoundingBoxId && !selectedTendrilId && !selectedEdgeId && !selectedSvgImageId">
      <h3>Diagram Properties</h3>
      <div class="name-control">
        <label>Diagram Name:</label>
        <input
          type="text"
          [value]="getCurrentDiagramName()"
          (input)="updateCurrentDiagramName($event)"
          placeholder="Enter diagram name..."
          class="name-input">
      </div>
    </div>

    <div class="toolbar-section">
      <h3>Diagram Actions</h3>
      <div class="action-buttons">
        <button (click)="newDiagram()" class="btn action-btn" title="New Diagram">ğŸ†•</button>
        <button *ngIf="canGoBack" (click)="goBack()" class="btn action-btn" title="Go Back">â¬…ï¸</button>
        <button (click)="saveDiagram()" class="btn action-btn" title="Save Diagram">ğŸ’¾</button>
        <input
          type="file"
          accept=".json"
          (change)="loadDiagram($event)"
          style="display: none"
          #fileInput>
        <button (click)="fileInput.click()" class="btn action-btn" title="Load Diagram">ğŸ“</button>
        <button (click)="exportToSvg()" class="btn action-btn" title="Export to SVG">ğŸ“¤</button>
        <button (click)="addNewNode()" class="btn btn-primary action-btn" title="Add Node">â•</button>
        <button (click)="addNewBoundingBox()" class="btn action-btn" title="Add Bounding Box">â–­</button>
        <input
          type="file"
          accept=".svg"
          (change)="loadSvgImage($event)"
          style="display: none"
          #svgInput>
        <button (click)="svgInput.click()" class="btn action-btn" title="Load SVG Image">ğŸ–¼ï¸</button>
      </div>
    </div>

    <div class="toolbar-section" *ngIf="selectedNodeId">
    <h3>Node Actions</h3>
    <button (click)="addIncomingTendril()" class="btn btn-tendril">+ Incoming Tendril</button>
    <button (click)="addOutgoingTendril()" class="btn btn-tendril">+ Outgoing Tendril</button>
    <button (click)="deleteSelectedNode()" class="btn btn-danger">ğŸ—‘ï¸ Delete Node</button>

    <div class="name-control">
      <label>Node Name:</label>
      <input
        type="text"
        [value]="getSelectedNodeName()"
        (input)="updateNodeName($event)"
        placeholder="Enter node name..."
        class="name-input">
    </div>

    <div class="shape-control">
      <label>Shape:</label>
      <div class="shape-buttons-grid">
        <div class="shape-row">
          <button
            (click)="setNodeShape('rectangle')"
            [class.active]="getSelectedNodeShape() === 'rectangle'"
            class="shape-btn"
            title="Rectangle - Process/Action">
            â–­
          </button>
          <button
            (click)="setNodeShape('circle')"
            [class.active]="getSelectedNodeShape() === 'circle'"
            class="shape-btn"
            title="Circle - Start/End">
            â—‹
          </button>
          <button
            (click)="setNodeShape('pill')"
            [class.active]="getSelectedNodeShape() === 'pill'"
            class="shape-btn"
            title="Pill - Input/Output">
            â–¬
          </button>
          <button
            (click)="setNodeShape('cylinder')"
            [class.active]="getSelectedNodeShape() === 'cylinder'"
            class="shape-btn"
            title="Cylinder - Database">
            â§ˆ
          </button>
          <button
            (click)="setNodeShape('diamond')"
            [class.active]="getSelectedNodeShape() === 'diamond'"
            class="shape-btn"
            title="Diamond - Decision">
            â—‡
          </button>
        </div>
        <div class="shape-row">
          <button
            (click)="setNodeShape('parallelogram')"
            [class.active]="getSelectedNodeShape() === 'parallelogram'"
            class="shape-btn"
            title="Parallelogram - Input/Output">
            â–°
          </button>
          <button
            (click)="setNodeShape('document')"
            [class.active]="getSelectedNodeShape() === 'document'"
            class="shape-btn"
            title="Document - Document">
            â–¯
          </button>
          <button
            (click)="setNodeShape('roundedRectangle')"
            [class.active]="getSelectedNodeShape() === 'roundedRectangle'"
            class="shape-btn"
            title="Rounded Rectangle - Process">
            â–¢
          </button>
          <button
            (click)="setNodeShape('hexagon')"
            [class.active]="getSelectedNodeShape() === 'hexagon'"
            class="shape-btn"
            title="Hexagon - Preparation">
            â¬¡
          </button>
          <button
            (click)="setNodeShape('triangle')"
            [class.active]="getSelectedNodeShape() === 'triangle'"
            class="shape-btn"
            title="Triangle - Manual Operation">
            â–³
          </button>
        </div>
        <div class="shape-row">
          <button
            (click)="setNodeShape('trapezoid')"
            [class.active]="getSelectedNodeShape() === 'trapezoid'"
            class="shape-btn"
            title="Trapezoid - Manual Input">
            â¢
          </button>
          <button
            (click)="setNodeShape('stickman')"
            [class.active]="getSelectedNodeShape() === 'stickman'"
            class="shape-btn"
            title="Stickman - Person/Actor">
            ğŸ§‘
          </button>
          <button
            (click)="setNodeShape('callout')"
            [class.active]="getSelectedNodeShape() === 'callout'"
            class="shape-btn"
            title="Callout - Speech Bubble">
            ğŸ’¬
          </button>
          <button
            (click)="setNodeShape('text')"
            [class.active]="getSelectedNodeShape() === 'text'"
            class="shape-btn"
            title="Text - Plain Text Label">
            ğŸ“
          </button>
        </div>
      </div>
    </div>

    <div class="color-controls">
      <label>Fill Color:</label>
      <input
        type="color"
        [value]="getSelectedNodeFillColor()"
        (change)="updateNodeFillColor($event)"
        class="color-input">

      <label>Border Color:</label>
      <input
        type="color"
        [value]="getSelectedNodeBorderColor()"
        (change)="updateNodeBorderColor($event)"
        class="color-input">
    </div>

    <div class="accordion-section">
      <button
        type="button"
        class="accordion-header"
        (click)="notesExpanded = !notesExpanded"
        [class.expanded]="notesExpanded">
        <span class="accordion-icon">{{ notesExpanded ? 'â–¼' : 'â–¶' }}</span>
        <span class="accordion-title">Notes</span>
      </button>
      <div class="accordion-content" [class.expanded]="notesExpanded">
        <div class="notes-control">
          <textarea
            [value]="getSelectedNodeNotes()"
            (input)="updateNodeNotes($event)"
            placeholder="Enter notes for this node..."
            class="notes-textarea"
            rows="4">
          </textarea>
        </div>
      </div>
    </div>
  </div>

  <div class="toolbar-section" *ngIf="selectedBoundingBoxId">
    <h3>Bounding Box Actions</h3>
    <div class="name-control">
      <label>Label:</label>
      <input
        type="text"
        [value]="getSelectedBoundingBoxLabel()"
        (input)="updateBoundingBoxLabel($event)"
        placeholder="Enter box label..."
        class="name-input">
    </div>

    <div class="color-controls">
      <label>Fill Color:</label>
      <input
        type="color"
        [value]="getSelectedBoundingBoxFillColor()"
        (change)="updateBoundingBoxFillColor($event)"
        class="color-input">

      <label>Border Color:</label>
      <input
        type="color"
        [value]="getSelectedBoundingBoxBorderColor()"
        (change)="updateBoundingBoxBorderColor($event)"
        class="color-input">
    </div>

    <button (click)="deleteSelectedBoundingBox()" class="btn btn-danger" style="margin-top: 15px;">ğŸ—‘ï¸ Delete Bounding Box</button>
  </div>

  <div class="toolbar-section" *ngIf="selectedSvgImageId">
    <h3>SVG Image Actions</h3>
    <div class="name-control">
      <label>Label:</label>
      <input
        type="text"
        [value]="getSelectedSvgImageLabel()"
        (input)="updateSvgImageLabel($event)"
        placeholder="Enter SVG label..."
        class="name-input">
    </div>
    <div class="action-buttons">
      <button (click)="addIncomingTendrilToSvgImage()" class="btn btn-tendril">+ Incoming Tendril</button>
      <button (click)="addOutgoingTendrilToSvgImage()" class="btn btn-tendril">+ Outgoing Tendril</button>
    </div>
  </div>

  <div class="toolbar-section" *ngIf="selectedTendrilId">
    <h3>Tendril Actions</h3>
    <div class="name-control">
      <label>{{ getSelectedTendrilTypeLabel() }}:</label>
      <input
        type="text"
        [value]="getSelectedTendrilName()"
        (input)="updateTendrilName($event)"
        placeholder="Enter tendril name..."
        class="name-input">
    </div>

    <div class="type-control">
      <label>Type:</label>
      <div class="radio-group">
        <label class="radio-label">
          <input
            type="radio"
            [checked]="getSelectedTendrilType() === 'incoming'"
            (change)="setTendrilType('incoming')"
            name="tendril-type">
          Incoming
        </label>
        <label class="radio-label">
          <input
            type="radio"
            [checked]="getSelectedTendrilType() === 'outgoing'"
            (change)="setTendrilType('outgoing')"
            name="tendril-type">
          Outgoing
        </label>
      </div>
    </div>

    <div class="exposure-control">
      <label>Visibility:</label>
      <div class="radio-group">
        <label class="radio-label">
          <input
            type="radio"
            [checked]="getSelectedTendrilExposed()"
            (change)="setTendrilExposed(true)"
            name="tendril-exposure">
          Exposed
        </label>
        <label class="radio-label">
          <input
            type="radio"
            [checked]="!getSelectedTendrilExposed()"
            (change)="setTendrilExposed(false)"
            name="tendril-exposure">
          Internal
        </label>
      </div>
    </div>

    <button (click)="deleteSelectedTendril()" class="btn btn-danger" style="margin-top: 15px;">ğŸ—‘ï¸ Delete Tendril</button>
  </div>

  <div class="toolbar-section" *ngIf="selectedEdgeId">
    <h3>Edge Actions</h3>
    <div class="name-control">
      <label>Edge Name:</label>
      <input
        type="text"
        [value]="getSelectedEdgeName()"
        (input)="updateEdgeName($event)"
        placeholder="Enter edge name..."
        class="name-input">
    </div>

    <button (click)="deleteSelectedEdge()" class="btn btn-danger" style="margin-top: 15px;">ğŸ—‘ï¸ Delete Edge</button>
  </div>

  <div class="toolbar-section">
    <div class="accordion-section">
      <button
        type="button"
        class="accordion-header"
        (click)="instructionsExpanded = !instructionsExpanded"
        [class.expanded]="instructionsExpanded">
        <span class="accordion-icon">{{ instructionsExpanded ? 'â–¼' : 'â–¶' }}</span>
        <span class="accordion-title">Instructions</span>
      </button>
      <div class="accordion-content" [class.expanded]="instructionsExpanded">
        <ul class="instructions">
          <li>Use "New Node" button to add nodes</li>
          <li>Drag nodes to reposition</li>
          <li>Drag blue circle on selected nodes to resize</li>
          <li>Right-click nodes to rename, customize colors & add notes</li>
          <li>Right-click tendrils to rename them</li>
          <li>Double-click nodes to enter inner diagrams</li>
          <li>Click orange tendrils to start edges, green tendrils to complete</li>
          <li>Right-click to cancel edge creation</li>
          <li>Right-click nodes/tendrils to select, then delete</li>
          <li>Press Delete key to remove selected items</li>
        </ul>
      </div>
    </div>
  </div>
  </div>
</div>
